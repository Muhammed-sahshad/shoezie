<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - SHOEZIE</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css">
    <link rel="stylesheet" href="/styles/admin/dashboard.css"> <!-- Point to your custom CSS -->

    <style>

    </style>
</head>
<body>
    <div class="d-flex " id="wrapper">
      <%- include('partials/sidebar') %>
        <div id="page-content-wrapper">
            <nav class="navbar navbar-expand-lg mb-1 mt-1">
                <button class="btn btn-light btn-sm" id="menuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="form-inline ml-auto">
                    <input class="form-control mr-sm-2 rounded-pill" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-dark my-2 my-sm-0 rounded-pill" type="submit">Search</button>
                </div>
            </nav>
            <div class="line"></div>
            <div class="container">
                <div class="row">
                    <div class="col-md-3 mb-4">
                        <div class="card custom-card card-users">
                            <div class="card-body">
                                <h5 class="card-title">Total Users</h5>
                                <p class="card-text" id="totalUsers"><%= users %></p>
                            </div>
                        </div>
                    </div>
            
                    <div class="col-md-3 mb-4">
                        <div class="card custom-card card-orders">
                            <div class="card-body">
                                <h5 class="card-title">Total Orders</h5>
                                <p class="card-text" id="totalOrders"><%= totalOrders %></p>
                            </div>
                        </div>
                    </div>
            
                    <div class="col-md-3 mb-4">
                        <div class="card custom-card card-sales">
                            <div class="card-body">
                                <h5 class="card-title">Total Sales</h5>
                                <p class="card-text" id="totalSales">₹ <%= totalSalesAmount.toFixed(2) %></p>
                            </div>
                        </div>
                    </div>
            
                    <div class="col-md-3 mb-4">
                        <div class="card custom-card card-pending">
                            <div class="card-body">
                                <h5 class="card-title">Total Pending</h5>
                                <p class="card-text" id="totalPending"><%= totalPendingOrders %></p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="container">
                <h4 class="my-4">Sales Charts</h4>
                <div class="btn-group" role="group" aria-label="Time Frame">
                    <button type="button" class="btn btn-outline-primary" onclick="updateChart('weekly')">Weekly</button>
                    <button type="button" class="btn btn-outline-primary" onclick="updateChart('monthly')">Monthly</button>
                    <button type="button" class="btn btn-outline-primary" onclick="updateChart('yearly')">Yearly</button>
                </div>
                <canvas id="salesChart" width="600" height="200"></canvas>
            </div>

            <div class="container mt-5">
                <div class="row">
                    <!-- Left: Top 10 Best-Selling Products -->
                    <div class="col-md-6">
                        <h5 class="mb-3">Best-Selling Products</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Image</th>
                                    <th>Product Name</th>
                                    <th>Total Sold</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% topProducts.forEach((product,index) => { %>
                                    <tr>
                                        <td># <%= index+1 %></td>
                                        <td>
                                            <img 
                                                src="<%= product.productImage %>" 
                                                alt="<%= product.productName %>" 
                                                width="50"
                                                height="50"
                                                style="object-fit: cover; border-radius: 5px;">
                                        </td>
                                        <td><%= product.productName %></td>
                                        <td><%= product.totalQuantity %></td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
            
                    <!-- Right: Top 10 Best-Selling Categories -->
                    <div class="col-md-6">
                        <h5 class="mb-3"> Best-Selling Categories</h5>
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>No</th>
                                    <th>Image</th>
                                    <th>Category Name</th>
                                    <th>Total Sold</th>
                                </tr>
                            </thead>
                            <tbody>
                                <% topCategories.forEach((category,index) => { %>
                                    <tr>
                                        <td>#<%= index+1 %></td>
                                        <td>
                                            <img 
                                                src="<%= category.categoryImage %>" 
                                                alt="<%= category.categoryName %>" 
                                                width="50"
                                                height="50"
                                                style="object-fit: cover; border-radius: 5px;">
                                        </td>
                                        <td><%= category.categoryName %></td>
                                        <td><%= category.totalQuantity %></td>
                                    </tr>
                                <% }) %>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div> 
        </div>
    </div>

    <div id="sales-data" data-sales='<%- JSON.stringify(salesData) %>'></div>

    
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        document.getElementById('menuToggle').addEventListener('click', function() {
            document.getElementById('sidebar').classList.toggle('active');
            document.getElementById('page-content-wrapper').classList.toggle('toggled');
        });

        const salesData = JSON.parse(document.getElementById('sales-data').dataset.sales);


    let currentChart; // Store the current chart instance

    const ctx = document.getElementById('salesChart').getContext('2d');

    function createChart(period) {
        const labels = Object.keys(salesData[period]);
        const data = Object.values(salesData[period]);

        if (currentChart) {
            currentChart.destroy(); // Destroy the previous chart instance
        }

        currentChart = new Chart(ctx, {
            type: 'bar',// Change to 'bar' for bar chart
            data: {
                labels: labels,
                datasets: [{
                    label: `${period.charAt(0).toUpperCase() + period.slice(1)} Sales`,
                    data: data,
                    backgroundColor: 'rgba(54, 162, 235, 0.2)', // Bar color
                    borderColor: 'rgba(54, 162, 235, 1)', // Border color
                    borderWidth: 1,
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Sales Amount (₹)', // Y-axis title
                        }
                    },
                    x: {
                        title: {
                            display: true,
                            text: 'Time Period', // X-axis title
                        }
                    }
                }
            }
        });
    }

    function updateChart(period) {
        createChart(period); // Call the createChart function with the selected period
    }

    // Initialize the chart with the default period
    updateChart('weekly'); // Load weekly data by default
    </script>
</body>
</html>
